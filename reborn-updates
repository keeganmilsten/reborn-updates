#!/bin/sh

official=`pacman -Qqtd | grep -Fv -f <(pacman -Qqtdm)`
unofficial=`pacman -Qqmtd`

Replace(){
echo "Fetching Mettke's keys..."
sudo pacman-key --recv 7448C890582975CD
sudo pacman-key --lsign 7448C890582975CD
echo "Recieved Mettke's keys"
echo
echo "Writing changes to pacman.conf..."
mv /tmp/pacman.conf1 /etc/pacman.conf
sudo pacman -Syy
echo "DONE"
}

Adding(){
echo "Fetching Mettke's keys..."
sudo pacman-key --recv 7448C890582975CD
sudo pacman-key --lsign 7448C890582975CD
echo "Recieved Mettke's keys"
echo
echo "Fetching Reborn's keys..."
wget https://repo.itmettke.de/Reborn-OS/rebornos-keyring-20180302-1-any.pkg.tar.xz
wget https://repo.itmettke.de/Reborn-OS/rebornos-keyring-20180302-1-any.pkg.tar.xz.sig
sudo pacman -U rebornos-keyring-20180302-1-any.pkg.tar.xz --noconfirm
echo "Recieved Reborn's keys"
echo
echo "Writing changes to pacman.conf..."
mv /tmp/pacman.conf2 /etc/pacman.conf
sudo pacman -Syy
echo "DONE"
sudo rm rebornos-keyring-20180302-1-any.pkg.tar.xz && rm rebornos-keyring-20180302-1-any.pkg.tar.xz.sig
}

Secure(){
echo "Fetching Reborn's keys..."
wget https://repo.itmettke.de/Reborn-OS/rebornos-keyring-20180302-1-any.pkg.tar.xz
wget https://repo.itmettke.de/Reborn-OS/rebornos-keyring-20180302-1-any.pkg.tar.xz.sig
sudo pacman -U rebornos-keyring-20180302-1-any.pkg.tar.xz --noconfirm
echo "Recieved Reborn's keys"
echo
echo "Writing changes to pacman.conf..."
mv /tmp/pacman.conf3 /etc/pacman.conf
sudo pacman -Syy
sudo rm rebornos-keyring-20180302-1-any.pkg.tar.xz && rm rebornos-keyring-20180302-1-any.pkg.tar.xz.sig
echo "DONE"
}

Unnecessary(){
pacman -Qqtd > /tmp/package-files.txt
yad --title "Unnecessary Packages" --skip-taskbar --form --center --text-align=center --width=300 --height=100 \
--text="Remove clutter with ease" \
--field="View Unnecessary Packages In Terminal:fbtn" "xterm -e nano /tmp/package-files.txt" \
--field="Remove All Unnecessary Packages:fbtn" "xterm -e sudo pacman -Rs $(pacman -Qqdt) --noconfirm" \
--button="Back":1
rm /tmp/package-files.txt
}

Update(){
if [ -f /usr/bin/octopi ]; then
octopi
fi

if [ -f /usr/bin/pamac-updater ]; then
pamac-updater
fi
}

Journal(){
journalctl --vacuum-time=3d && sync
}

Cache(){
pacman -Scc --noconfirm
}

Clean(){
paccache -ruk0
}

export -f Replace Adding Secure Unnecessary Update Journal Cache Clean

yad --plug=23456 --tabnum=1 --form --columns=2 --center --text-align=center \
--text="The following applications are available for install:" \
--field='Wine!!'"Easily run several Windows programs on Linux - safely. Wine offers a simple, non-technical method of installing Windows software. Simply download the desired .exe file like you normally would for Windows, and then right click to run using Wine. It's as easy as that.:fbtn" "xterm -e sudo pacman wine winetricks playonlinux --noconfirm" \
--field='NixNote2!!'"Nixnote, (formerly Nevernote) is an opensource client for Evernote, allowing you to track your digital life in a single, convenient place. NOTE: an Evernote account is required for cloud synchronization.:fbtn" "xterm -e sudo pacman -S nixnote2 --noconfirm" \
--field='Reborn Recovery!!'"Reborn Recovery allows you to save a list of all your installed programs in a file so that you can reinstall them later.:fbtn" "xterm -e sudo pacman -S reborn-recovery --noconfirm" \
--field='Hardinfo!!'"Simple application for hardware analysis and system benchmarking. Through this, you can easily view all of your system specs without having to revert to the commandline.:fbtn" "xterm -e sudo pacman -S hardinfo --noconfirm" &

yad --plug=23456 --tabnum=2 --form --center --text-align=center \
--text="Please consider adding the following to your system:" \
--field="Mettke's Repo!!""Replace BlueStars Repo with Mettkes Repo, offering more packages as well as faster mirror speeds:fbtn" 'xterm -e "Replace"' \
--field="Reborn's European Mirror (Recommended)!!""Add Reborn's new European mirror to your mirrorlist, offering quicker and more reliable download speeds for those in Europe:fbtn" 'xterm -e "Adding"' \
--field="Add Nothing New, Only Upgrade Reborn's Security (Not Recommended)!!""The Reborn Repository now has updated security features available for you. To continue using Reborn OS safely, please upgrade them now. Thanks!:fbtn" 'xterm -e "Secure"' &

yad --plug=23456 --tabnum=3 --form --title="System Maintenance" --center --text-align=center --columns=2 \
--text="A few simple commands to keep Reborn working flawlessly and your system clean" \
--field="Clear Cache:fbtn" 'gksudo "Cache"' \
--field="Clean Journal:fbtn" 'gksudo "Journal"' \
--field="Clean Built Packages:fbtn" 'gksudo "Clean"' \
--field="Rank Mirrors:fbtn" "xterm -e sudo reflector --verbose --age 8 --fastest 128 --latest 64 --number 32 --sort rate --save /etc/pacman.d/mirrorlist" \
--field="Unnecessary Packages:fbtn" '@bash -c "Unnecessary"' \
--field="Update System:fbtn" '@bash -c "Update"' &

yad --notebook --center --key=23456 --tab="New Applications" --tab="Repositories" --tab="Maintenance" --button=gtk-quit:1 \
--title="Reborn Improvements" \
